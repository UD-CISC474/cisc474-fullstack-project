import{a as H}from"./chunk-MQZJN7XP.js";import{a as Y,d as $,h as j,j as G,m as L,o as W,q as Q}from"./chunk-JC2O5M7I.js";import"./chunk-B2RI2W33.js";import{a as R}from"./chunk-725IIR4X.js";import{ba as N,ga as U,i as D}from"./chunk-YFSGSCRV.js";import{h as A,i as z}from"./chunk-JJ33YEFS.js";import{$b as v,A as y,Aa as g,Eb as o,Fb as r,Hb as M,Lb as h,Mb as P,Wb as c,Xb as C,Yb as _,Zb as V,_b as x,ac as S,bb as l,cb as f,cc as I,dc as E,e as q,g as m,ic as F,pa as w,sb as b,wb as k,z as T,za as d}from"./chunk-WECLO23R.js";var O=q(H());var J=()=>["1D","5D","1M","6M","1Y","2Y"];function K(u,t){if(u&1){let n=M();o(0,"div",26),h("click",function(){let i=d(n).$implicit,s=P();return g(s.selectTicker(i))})("keyup.enter",function(){let i=d(n).$implicit,s=P();return g(s.selectTicker(i))}),o(1,"span",27),c(2),r(),o(3,"span",28),c(4),r()()}if(u&2){let n=t.$implicit;l(2),C(n.T),l(2),_("",n.c," USD")}}function X(u,t){u&1&&(o(0,"div",29),c(1," No stocks found. "),r())}function Z(u,t){u&1&&(o(0,"span"),c(1,"Loading..."),r())}function ee(u,t){if(u&1){let n=M();o(0,"button",30),h("click",function(){let i=d(n).$implicit,s=P();return g(s.updateGraphPeriod(i))}),c(1),r()}if(u&2){let n=t.$implicit;l(),_(" ",n," ")}}var B=class u{constructor(t,n,e){this.auth=t;this.marketService=n;this.router=e;U(t,i=>{i?(this.userId=i.uid,console.log(`Authenticated user: ${this.userId}`)):(this.router.navigate(["/profile"]),console.log("No user authenticated. Using default-user."))})}tickers=[];filteredTickers=[];searchQuery="";selectedTicker=null;currentPage=1;itemsPerPage=50;totalPages=0;paginatedTickers=[];userId="default-user";amount=1;purchaseMessage="";sellMessage="";ngOnInit(){console.log(this.userId);let t;(0,O.default)().day().toString()==="Monday"?t=(0,O.default)().subtract(3,"day").format("YYYY-MM-DD"):t=(0,O.default)().subtract(1,"day").format("YYYY-MM-DD"),this.loadTickers(t)}loadTickers(t){return m(this,null,function*(){try{let n=yield y(this.marketService.getTickers(t));console.log("Full ticker response:",n);let e=n?.response?.results;e&&Array.isArray(e)&&e.length>0?(this.tickers=e,this.selectedTicker={T:this.tickers[0].T,c:this.tickers[0].c,h:this.tickers[0].h,l:this.tickers[0].l,n:this.tickers[0].n,o:this.tickers[0].o,t:this.tickers[0].t,v:this.tickers[0].v,vw:this.tickers[0].vw,uv:0,us:0},yield this.updateSelectedTickerValue(),this.filterTickers()):(console.warn("No tickers found in the response:",n),this.tickers=[])}catch(n){console.error("Failed to load tickers",n),this.tickers=[],this.filteredTickers=[]}})}increaseAmount(){this.amount++}decreaseAmount(){this.amount>1&&this.amount--}updateGraphPeriod(t){console.log(`Graph updated for period: ${t}`)}buyStock(t){if(!this.selectedTicker||t<=0){this.purchaseMessage="Please select a stock and enter a valid amount.";return}let n={userId:this.userId,stockSymbol:this.selectedTicker.T,shares:t,price:this.selectedTicker.c};this.marketService.purchaseStock(n).subscribe({next:e=>m(this,null,function*(){yield this.updateSelectedTickerValue(),this.purchaseMessage=`Successfully purchased ${t} shares of ${this.selectedTicker?.T}!`,console.log("Purchase Response:",e)}),error:e=>{this.purchaseMessage="Failed to purchase stock. Try again.",console.error("Purchase Error:",e)}})}getStocks(){return T(this.marketService.getUserStocks(this.userId))}getUserStock(){return m(this,null,function*(){try{let n=(yield this.getStocks()).stocks,e=Object.entries(n).map(([a,p])=>({id:a,stock:p})),i=0,s=0;return e&&e.length>0&&e.filter(({stock:p})=>p.stockSymbol===this.selectedTicker?.T).map(({stock:p})=>{i+=p.price*p.shares,s+=p.shares}),[Number(i.toFixed(2)),s]}catch(t){return console.error("Error fetching stocks:",t),[0,0]}})}sellStock(t){return m(this,null,function*(){try{let e=(yield this.getStocks()).stocks,i=Object.entries(e).map(([s,a])=>({id:s,stock:a}));if(i&&i.length>0){let s=i.find(({stock:a})=>a.stockSymbol===this.selectedTicker?.T&&a.price===this.selectedTicker?.c&&t<=a.shares);if(s){console.log(`Selling ${t} shares of ${s.stock.stockSymbol}`);let a={userId:this.userId,stockSymbol:this.selectedTicker.T,shares:s.stock.shares-t,price:this.selectedTicker.c,stockId:s.id};this.marketService.updateUserStocks(a).subscribe({next:p=>m(this,null,function*(){yield this.updateSelectedTickerValue(),this.sellMessage=`Successfully sold ${t} shares of ${this.selectedTicker?.T}!`,console.log("Update successful:",p)}),error:p=>{this.sellMessage="Failed to sell stock. Try again.",console.error("Error updating stock:",p)}})}else console.log("Selected stock not found in user holdings"),this.sellMessage="Selected stock not found in user holdings."}else console.log("No stocks found in user holdings"),this.sellMessage="No stocks found in user holdings."}catch(n){console.error("Error fetching stocks:",n),this.sellMessage="Error fetching stocks. Please try again."}})}updateSelectedTickerValue(){return m(this,null,function*(){if(this.selectedTicker){let t=yield this.getUserStock();this.selectedTicker.uv=t[0],this.selectedTicker.us=t[1]}})}updatePagination(){this.totalPages=Math.ceil(this.filteredTickers.length/this.itemsPerPage);let t=(this.currentPage-1)*this.itemsPerPage,n=t+this.itemsPerPage;this.paginatedTickers=this.filteredTickers.slice(t,n)}goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.updatePagination())}selectTicker(t){return m(this,null,function*(){this.selectedTicker={T:t.T,c:t.c,h:t.h,l:t.l,n:t.n,o:t.o,t:t.t,v:t.v,vw:t.vw,uv:0,us:0};let n=yield this.getUserStock();this.selectedTicker.uv=n[0],this.selectedTicker.us=n[1],this.amount=1})}filterTickers(){let t=this.searchQuery.toLowerCase().trim();this.filteredTickers=this.tickers.filter(n=>n.T.toLowerCase().includes(t)),this.currentPage=1,this.updatePagination()}static \u0275fac=function(n){return new(n||u)(f(N),f(R),f(D))};static \u0275cmp=w({type:u,selectors:[["app-market"]],standalone:!0,features:[I],decls:58,vars:16,consts:[["noSelection",""],[1,"container"],[1,"left-section"],[1,"search-bar-container"],["type","text","placeholder","Search for a ticker...","aria-label","Search for a stock ticker",1,"search-bar",3,"ngModelChange","input","ngModel"],[1,"stock-list"],["class","stock-item","tabindex","0","role","button",3,"click","keyup.enter",4,"ngFor","ngForOf"],["class","no-results",4,"ngIf"],[1,"pagination-controls"],["mat-icon-button","","aria-label","Go to previous page",3,"click","disabled"],["aria-live","polite"],["mat-icon-button","","aria-label","Go to next page",3,"click","disabled"],[1,"right-section"],[1,"graph-content"],[1,"graph-header"],[1,"purchase-controls"],["for","stock-amount"],[1,"amount-buttons"],["mat-icon-button","",3,"click","disabled"],["id","stock-amount","type","number","min","1","aria-label","Enter the number of shares",3,"ngModelChange","ngModel"],["mat-icon-button","",3,"click"],["aria-label","Buy selected stock",3,"click","disabled"],["aria-label","Sell selected stock",3,"click"],[1,"graph"],[1,"graph-buttons-container"],["class","graph-button",3,"click",4,"ngFor","ngForOf"],["tabindex","0","role","button",1,"stock-item",3,"click","keyup.enter"],[1,"stock-name"],[1,"stock-price"],[1,"no-results"],[1,"graph-button",3,"click"]],template:function(n,e){if(n&1){let i=M();o(0,"div",1)(1,"div",2)(2,"h2"),c(3,"Stocks"),r(),o(4,"div",3)(5,"input",4),S("ngModelChange",function(a){return d(i),v(e.searchQuery,a)||(e.searchQuery=a),g(a)}),h("input",function(){return d(i),g(e.filterTickers())}),r()(),o(6,"div",5),b(7,K,5,2,"div",6)(8,X,2,0,"div",7),r(),o(9,"div",8)(10,"button",9),h("click",function(){return d(i),g(e.goToPage(e.currentPage-1))}),o(11,"mat-icon"),c(12,"chevron_left"),r()(),o(13,"span",10),c(14),r(),o(15,"button",11),h("click",function(){return d(i),g(e.goToPage(e.currentPage+1))}),o(16,"mat-icon"),c(17,"chevron_right"),r()()()(),o(18,"div",12)(19,"div",13)(20,"div",14)(21,"h3"),c(22),r(),o(23,"p"),c(24," Current Price: "),o(25,"span"),c(26),r()(),o(27,"p"),c(28," You own: "),o(29,"span"),c(30),r(),o(31,"span"),c(32," shares, totaling to $"),r(),o(33,"span"),c(34),r()(),b(35,Z,2,0,"ng-template",null,0,F),o(37,"div",15)(38,"label",16),c(39,"Amount:"),r(),o(40,"div",17)(41,"button",18),h("click",function(){return d(i),g(e.decreaseAmount())}),o(42,"mat-icon"),c(43,"remove"),r()(),o(44,"input",19),S("ngModelChange",function(a){return d(i),v(e.amount,a)||(e.amount=a),g(a)}),r(),o(45,"button",20),h("click",function(){return d(i),g(e.increaseAmount())}),o(46,"mat-icon"),c(47,"add"),r()()(),o(48,"div")(49,"button",21),h("click",function(){return d(i),g(e.buyStock(e.amount))}),c(50," Buy "),r(),o(51,"button",22),h("click",function(){return d(i),g(e.sellStock(e.amount))}),c(52," Sell "),r()()()(),o(53,"div",23)(54,"div"),c(55,"Insert Graph Here"),r()(),o(56,"div",24),b(57,ee,2,1,"button",25),r()()()()}n&2&&(l(5),x("ngModel",e.searchQuery),l(2),k("ngForOf",e.paginatedTickers),l(),k("ngIf",e.paginatedTickers.length===0),l(2),k("disabled",e.currentPage===1),l(4),V("Page ",e.currentPage," of ",e.totalPages,""),l(),k("disabled",e.currentPage===e.totalPages),l(7),C((e.selectedTicker==null?null:e.selectedTicker.T)||"Select a Stock"),l(4),_(" ",(e.selectedTicker==null?null:e.selectedTicker.c)||"Loading"," USD "),l(4),C((e.selectedTicker==null?null:e.selectedTicker.us)||"0"),l(4),_(" ",(e.selectedTicker==null?null:e.selectedTicker.uv)||"0"," USD "),l(7),k("disabled",e.amount===1),l(3),x("ngModel",e.amount),l(5),k("disabled",!e.selectedTicker||e.amount<=0),l(8),k("ngForOf",E(15,J)))},dependencies:[A,W,Y,G,$,L,j,z,Q],styles:[".container[_ngcontent-%COMP%]{display:flex;width:100%;height:89vh}.left-section[_ngcontent-%COMP%]{width:50%;padding:20px;display:flex;flex-direction:column;gap:10px;max-height:80vh;overflow-y:auto;overflow-x:hidden}.left-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#333;margin-bottom:15px}.left-section[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]{width:97.5%;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:16px;margin-bottom:15px;outline:none;transition:border-color .3s,box-shadow .3s}.left-section[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]:focus{border-color:#2196f3;box-shadow:0 0 4px #2196f366}.left-section[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0000001a}.left-section[_ngcontent-%COMP%]   .stock-list[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto;background-color:#f9f9f9;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0000001a}.left-section[_ngcontent-%COMP%]   .stock-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px;background-color:#fff;border-radius:5px;margin-bottom:10px;cursor:pointer;transition:background-color .3s,transform .1s;box-shadow:0 2px 4px #0000001a}.left-section[_ngcontent-%COMP%]   .stock-item[_ngcontent-%COMP%]:hover{background-color:#e3f2fd;transform:scale(1.02)}.left-section[_ngcontent-%COMP%]   .stock-item[_ngcontent-%COMP%]   .stock-name[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:#333}.left-section[_ngcontent-%COMP%]   .stock-item[_ngcontent-%COMP%]   .stock-price[_ngcontent-%COMP%]{font-size:14px;color:#333;font-weight:500}.right-section[_ngcontent-%COMP%]{width:50%;padding:20px;display:flex;flex-direction:column;background-color:#fff}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]{background-color:#f1f1f1;padding:20px;border-radius:8px;margin-bottom:20px;box-shadow:0 4px 8px #0000001a;text-align:center}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#333}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .stock-price[_ngcontent-%COMP%]{font-size:16px;color:#666;font-weight:500}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;align-items:center}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;color:#666;font-weight:500}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:60px;padding:5px;border:1px solid #ddd;border-radius:5px;font-size:14px;text-align:center;outline:none;transition:border-color .3s,box-shadow .3s}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]:focus{border-color:#2196f3;box-shadow:0 0 4px #2196f366}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 12px;background-color:#4caf50;border:none;color:#fff;font-size:14px;border-radius:5px;cursor:pointer;transition:background-color .3s;margin:5px}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#43a047}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{background-color:#388e3c;transform:scale(.98)}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .purchase-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]{display:flex;gap:10px}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;background-color:initial;border:none;color:initial;font-size:14px;border-radius:5px;cursor:pointer;transition:background-color .3s}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0000001a}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{background-color:#0000001a;transform:scale(.98)}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:initial;color:#d3d3d3}.right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]   #stock-amount[_ngcontent-%COMP%]::-webkit-inner-spin-button, .right-section[_ngcontent-%COMP%]   .graph-header[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]   #stock-amount[_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.right-section[_ngcontent-%COMP%]   .graph-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.right-section[_ngcontent-%COMP%]   .graph-content[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:15px;background-color:#f9f9f9;border-radius:8px;box-shadow:0 4px 8px #0000001a}.right-section[_ngcontent-%COMP%]   .graph-content[_ngcontent-%COMP%]   .graph-buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px}.right-section[_ngcontent-%COMP%]   .graph-content[_ngcontent-%COMP%]   .graph-buttons-container[_ngcontent-%COMP%]   .graph-button[_ngcontent-%COMP%]{padding:8px 12px;background-color:#2196f3;border:none;color:#fff;font-size:14px;border-radius:5px;cursor:pointer;transition:background-color .3s}.right-section[_ngcontent-%COMP%]   .graph-content[_ngcontent-%COMP%]   .graph-buttons-container[_ngcontent-%COMP%]   .graph-button[_ngcontent-%COMP%]:hover{background-color:#1976d2}.right-section[_ngcontent-%COMP%]   .graph-content[_ngcontent-%COMP%]   .graph-buttons-container[_ngcontent-%COMP%]   .graph-button[_ngcontent-%COMP%]:active{background-color:#1565c0;transform:scale(.98)}.pagination-controls[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:15px;gap:10px}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 8px;background-color:initial;border:none;font-size:14px;border-radius:5px;cursor:pointer;transition:background-color .3s}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0000001a}.pagination-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:#333}"]})};export{B as MarketComponent};
